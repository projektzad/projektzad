{% extends "base.html" %}

{% block content %}
    <h1>Select Options</h1>
    
    <form method="POST" action="{{ url_for('main.checkbox_form') }}">
        <input type="hidden" name="previous_url" value="{{ request.referrer }}">

        <table class="table">
            <thead>
                <tr>
                    <th>Option</th>
                    <th>
                        <input type="checkbox" id="selectAllColumns" onclick="toggleAll('column')">
                        Use as Column
                    </th>
                    <th>
                        <input type="checkbox" id="selectAllFilters" onclick="toggleAll('filter')">
                        Filter Non-Empty
                    </th>
                </tr>
            </thead>
            <tbody>
                {% for option in options %}
                <tr>
                    <td>{{ option }}</td>
                    <td>
                        <input type="checkbox" class="form-check-input column-checkbox" id="col_{{ option }}" 
                               name="column_options" value="{{ option }}"
                               {% if option in preselected_columns %} checked {% endif %}>
                    </td>
                    <td>
                        <input type="checkbox" class="form-check-input filter-checkbox" id="filter_{{ option }}" 
                               name="filter_options" value="{{ option }}"
                               {% if option in preselected_filters %} checked {% endif %}>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Buttons to select or deselect all -->
        <div class="form-group">
            <button type="button" class="btn btn-secondary" onclick="toggleAll('column', true)">Select All Columns</button>
            <button type="button" class="btn btn-secondary" onclick="toggleAll('column', false)">Deselect All Columns</button>
            <button type="button" class="btn btn-secondary" onclick="toggleAll('filter', true)">Select All Filters</button>
            <button type="button" class="btn btn-secondary" onclick="toggleAll('filter', false)">Deselect All Filters</button>
        </div>

        <button type="submit" class="btn btn-primary">Submit</button>
    </form>

    <script>
        function toggleAll(type, state = null) {
            let checkboxes;
            if (type === 'column') {
                checkboxes = document.querySelectorAll('.column-checkbox');
            } else if (type === 'filter') {
                checkboxes = document.querySelectorAll('.filter-checkbox');
            }
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = state !== null ? state : !checkbox.checked;
            });
        }
    </script>
{% endblock %}
